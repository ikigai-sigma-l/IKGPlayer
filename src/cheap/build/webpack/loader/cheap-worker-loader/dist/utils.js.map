{"version":3,"file":"utils.js","names":["_loaderUtils","require","getDefaultFilename","filename","replace","getDefaultChunkFilename","chunkFilename","getExternalsType","compilerOptions","output","libraryTarget","externalsType","library","type","module","workerGenerator","loaderContext","workerFilename","workerSource","options","workerConstructor","workerOptions","worker","esModule","fnName","inline","InlineWorkerPath","stringifyRequest","resolve","fallbackWorkerPath","JSON","stringify","innerRegex","sourceMappingURLRegex","exports","RegExp","source","sourceURLWebpackRegex"],"sourceRoot":"../../src/cheap/build/webpack/cheap-worker-loader/src","sources":["../src/utils.js"],"sourcesContent":["import { stringifyRequest } from 'loader-utils';\n\nfunction getDefaultFilename(filename) {\n  if (typeof filename === 'function') {\n    return filename;\n  }\n\n  return filename.replace(/\\.([a-z]+)(\\?.+)?$/i, '.worker.$1$2');\n}\n\nfunction getDefaultChunkFilename(chunkFilename) {\n  return chunkFilename.replace(/\\.([a-z]+)(\\?.+)?$/i, '.worker.$1$2');\n}\n\nfunction getExternalsType(compilerOptions) {\n  // For webpack@4\n  if (compilerOptions.output.libraryTarget) {\n    return compilerOptions.output.libraryTarget;\n  }\n\n  // For webpack@5\n  if (compilerOptions.externalsType) {\n    return compilerOptions.externalsType;\n  }\n\n  if (compilerOptions.output.library) {\n    return compilerOptions.output.library.type;\n  }\n\n  if (compilerOptions.output.module) {\n    return \"module\";\n  }\n\n  return \"var\";\n}\n\nfunction workerGenerator(loaderContext, workerFilename, workerSource, options) {\n  let workerConstructor;\n  let workerOptions;\n\n  if (typeof options.worker === \"undefined\") {\n    workerConstructor = \"Worker\";\n  } else if (typeof options.worker === \"string\") {\n    workerConstructor = options.worker;\n  } else {\n    ({ type: workerConstructor, options: workerOptions } = options.worker);\n  }\n\n  const esModule =\n    typeof options.esModule !== \"undefined\" ? options.esModule : true;\n  const fnName = `${workerConstructor}_fn`;\n\n  if (options.inline) {\n    const InlineWorkerPath = stringifyRequest(\n      loaderContext,\n      `!!${require.resolve(\"./runtime/inline.js\")}`\n    );\n\n    let fallbackWorkerPath;\n\n    if (options.inline === \"fallback\") {\n      fallbackWorkerPath = `__webpack_public_path__ + ${JSON.stringify(\n        workerFilename\n      )}`;\n    }\n\n    return `\n${\n  esModule\n    ? `import worker from ${InlineWorkerPath};`\n    : `var worker = require(${InlineWorkerPath});`\n}\n\n${\n  esModule ? \"export default\" : \"module.exports =\"\n} function ${fnName}() {\\n  return worker(${JSON.stringify(\n      workerSource\n    )}, ${JSON.stringify(workerConstructor)}, ${JSON.stringify(\n      workerOptions\n    )}, ${fallbackWorkerPath});\\n}\\n`;\n  }\n\n  return `${\n    esModule ? \"export default\" : \"module.exports =\"\n  } function ${fnName}() {\\n  return new ${workerConstructor}(__webpack_public_path__ + ${JSON.stringify(\n    workerFilename\n  )}${workerOptions ? `, ${JSON.stringify(workerOptions)}` : \"\"});\\n}\\n`;\n}\n\n// Matches only the last occurrence of sourceMappingURL\nconst innerRegex =\n  /\\s*[#@]\\s*sourceMappingURL\\s*=\\s*(.*?(?=[\\s'\"]|\\\\n|\\*\\/|$)(?:\\\\n)?)\\s*/;\n\n/* eslint-disable prefer-template */\nconst sourceMappingURLRegex = RegExp(\n  \"(?:\" +\n    \"/\\\\*\" +\n    \"(?:\\\\s*\\r?\\n(?://)?)?\" +\n    \"(?:\" +\n    innerRegex.source +\n    \")\" +\n    \"\\\\s*\" +\n    \"\\\\*/\" +\n    \"|\" +\n    \"//(?:\" +\n    innerRegex.source +\n    \")\" +\n    \")\" +\n    \"\\\\s*\"\n);\n\nconst sourceURLWebpackRegex = RegExp(\n  \"\\\\/\\\\/#\\\\ssourceURL=webpack-internal:\\\\/\\\\/\\\\/(.*?)\\\\\\\\n\"\n);\n/* eslint-enable prefer-template */\n\nexport {\n  getDefaultFilename,\n  getDefaultChunkFilename,\n  getExternalsType,\n  workerGenerator,\n  sourceMappingURLRegex,\n  sourceURLWebpackRegex,\n};\n"],"mappings":"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"}