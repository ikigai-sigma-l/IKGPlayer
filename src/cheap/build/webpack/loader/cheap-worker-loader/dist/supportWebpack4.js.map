{"version":3,"file":"supportWebpack4.js","names":["_utils","require","runAsChild","loaderContext","workerContext","options","callback","compiler","error","entries","compilation","workerFilename","files","workerSource","assets","source","inline","_compilation","replace","sourceMappingURLRegex","sourceURLWebpackRegex","workerCode","workerGenerator","Error","request"],"sourceRoot":"../../src/cheap/build/webpack/cheap-worker-loader/src","sources":["../src/supportWebpack4.js"],"sourcesContent":["import {\n  workerGenerator,\n  sourceMappingURLRegex,\n  sourceURLWebpackRegex,\n} from \"./utils\";\n\nexport default function runAsChild(\n  loaderContext,\n  workerContext,\n  options,\n  callback\n) {\n  workerContext.compiler.runAsChild((error, entries, compilation) => {\n    if (error) {\n      return callback(error);\n    }\n\n    if (entries[0]) {\n      // eslint-disable-next-line no-param-reassign, prefer-destructuring\n      const workerFilename = entries[0].files[0];\n\n      let workerSource = compilation.assets[workerFilename].source();\n\n      if (options.inline === \"no-fallback\") {\n        // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n        delete loaderContext._compilation.assets[workerFilename];\n\n        // TODO improve it, we should store generated source maps files for file in `assetInfo`\n        // eslint-disable-next-line no-underscore-dangle\n        if (loaderContext._compilation.assets[`${workerFilename}.map`]) {\n          // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n          delete loaderContext._compilation.assets[`${workerFilename}.map`];\n        }\n\n        // Remove `/* sourceMappingURL=url */` comment\n        workerSource = workerSource.replace(sourceMappingURLRegex, \"\");\n\n        // Remove `//# sourceURL=webpack-internal` comment\n        workerSource = workerSource.replace(sourceURLWebpackRegex, \"\");\n      }\n\n      const workerCode = workerGenerator(\n        loaderContext,\n        workerFilename,\n        workerSource,\n        options\n      );\n\n      return callback(null, workerCode);\n    }\n\n    return callback(\n      new Error(\n        `Failed to compile web worker \"${workerContext.request}\" request`\n      )\n    );\n  });\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAMe,SAASC,UAAUA,CAChCC,aAAa,EACbC,aAAa,EACbC,OAAO,EACPC,QAAQ,EACR;EACAF,aAAa,CAACG,QAAQ,CAACL,UAAU,CAAC,CAACM,KAAK,EAAEC,OAAO,EAAEC,WAAW,KAAK;IACjE,IAAIF,KAAK,EAAE;MACT,OAAOF,QAAQ,CAACE,KAAK,CAAC;IACxB;IAEA,IAAIC,OAAO,CAAC,CAAC,CAAC,EAAE;MACd;MACA,MAAME,cAAc,GAAGF,OAAO,CAAC,CAAC,CAAC,CAACG,KAAK,CAAC,CAAC,CAAC;MAE1C,IAAIC,YAAY,GAAGH,WAAW,CAACI,MAAM,CAACH,cAAc,CAAC,CAACI,MAAM,CAAC,CAAC;MAE9D,IAAIV,OAAO,CAACW,MAAM,KAAK,aAAa,EAAE;QACpC;QACA,OAAOb,aAAa,CAACc,YAAY,CAACH,MAAM,CAACH,cAAc,CAAC;;QAExD;QACA;QACA,IAAIR,aAAa,CAACc,YAAY,CAACH,MAAM,CAAE,GAAEH,cAAe,MAAK,CAAC,EAAE;UAC9D;UACA,OAAOR,aAAa,CAACc,YAAY,CAACH,MAAM,CAAE,GAAEH,cAAe,MAAK,CAAC;QACnE;;QAEA;QACAE,YAAY,GAAGA,YAAY,CAACK,OAAO,CAACC,4BAAqB,EAAE,EAAE,CAAC;;QAE9D;QACAN,YAAY,GAAGA,YAAY,CAACK,OAAO,CAACE,4BAAqB,EAAE,EAAE,CAAC;MAChE;MAEA,MAAMC,UAAU,GAAG,IAAAC,sBAAe,EAChCnB,aAAa,EACbQ,cAAc,EACdE,YAAY,EACZR,OACF,CAAC;MAED,OAAOC,QAAQ,CAAC,IAAI,EAAEe,UAAU,CAAC;IACnC;IAEA,OAAOf,QAAQ,CACb,IAAIiB,KAAK,CACN,iCAAgCnB,aAAa,CAACoB,OAAQ,WACzD,CACF,CAAC;EACH,CAAC,CAAC;AACJ"}